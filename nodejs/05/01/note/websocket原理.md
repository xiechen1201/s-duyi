# websocket 原理

## socket

是一个抽象层，基于 TCP/IP 协议。

- 客户端链接服务器（TCP/IP），建立连接通道（三次握手）

- 客户端和服务端通过 socket 进行通信（发送和接收消息），任何一段在任何时候都可以向另外的一段发送任何消息

- 有一端断开了，通道销毁

## http

- 客户端链接服务器（TCP/IP），建立连接通道（三次握手）

- 客户端发送一个 http 格式的消息（消息头、消息体），服务端响应 http 格式的消息（消息头、消息体）

- 客户端或者服务的断开，通道销毁

    - 如果是长链接，则不着急关闭链接，但是模式是一样的

区别：http 很快就会销毁。http 消息格式有限制。http 只能由客户端发起请求，服务端响应。

缺点：如果对实时性要求比较高，http 就无能为力。

办法：

- 轮询：很多无用的询问，每次都要经过三次握手，浪费资源；

- 长链接：客户端发出请求，服务端不响应，对服务器来说，线程一直处于阻塞状态，相比轮询相对好一点；

- websocket 协议：HTML5 提供的一种新的协议，建立在 socket 基础上，解决了 http 协议的缺点。

## websocket

专门用于解决实时性的问题。

- 客户端链接服务器（TCP/IP），建立连接通道（三次握手）

- 客户端主动发送一个 http 格式的消息（特殊格式），服务器也响应一个 http 格式的消息（特殊格式），称为 http 握手

- 双方自由通信，格式按照 websocket 协议进行

- 任何一方断开，通道销毁

```http
connection: Upgrade
upgrade: websocket
```